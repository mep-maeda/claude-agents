# Example 01: シンプルなUI変更

このサンプルでは、エラーダイアログにエラーコードを追加する、シンプルなUI変更の例を示します。

## プロンプト作成のヒント

### 1. INPUT資料の準備

**推奨：Markdown形式に変換**
- 元仕様書、設計書などをMarkdown（.md）に変換
- **項番を必ず付ける**（例: 1.1, 1.2, 2.1）
- トークン消費が少なく、検索・参照が容易
- エージェントが必要な箇所を素早く見つけられる

**PDFのまま使用する場合（限定的）**
- **図表が重要な場合のみ**
- **5ページ程度まで**に限定
- ページ番号を明記して参照箇所を指定
- トークン消費が多いため、大規模なPDFは避ける

**変換例：元仕様書のMarkdown化**
```markdown
# エラー処理仕様書 v1.0

## 1. エラーダイアログ仕様
### 1.1 表示内容
- エラーメッセージのみ表示
- タイトル: "エラー"
- ボタン: OKのみ

## 2. エラー種別
### 2.1 ファイル関連エラー
- ファイルが見つからない
- ファイルアクセス権限エラー

### 2.2 通信エラー
- 接続タイムアウト
- サーバー応答なし
```

### 2. 変更仕様の整理（強く推奨）

**Claude Web Chatで事前整理することを強く推奨します**

シンプルな変更でも、Claude Web Chat（https://claude.ai）で要件を整理することで、見落としを防げます。

**実際の手順：**

1. **Claude Web Chatを開く**
   - https://claude.ai にアクセス

2. **元仕様書や変更要求の概要を貼り付ける**
   ```
   【あなた】
   以下の元仕様書を読んで、エラーダイアログにエラーコードを追加する
   変更要求を整理してください。

   （元仕様書のMarkdownを貼り付け）

   変更したいこと：
   - エラーメッセージの前にエラーコード（例: E001）を追加
   - 表示例：「[E001] ファイルが見つかりません」
   ```

3. **Claudeと対話しながら変更仕様を整理**
   ```
   【Claude】
   以下のように整理できます：

   【現状】
   - エラーダイアログ: メッセージのみ表示
   - 表示例: "ファイルが見つかりません"
   - エラーコード管理: なし

   【変更後】
   - エラーダイアログ: エラーコード + メッセージ表示
   - 表示例: "[E001] ファイルが見つかりません"
   - エラーコード管理: ErrorCodes.cs を新規作成

   【影響範囲】
   1. ErrorDialog.cs
      - ShowError() メソッドの変更
      - エラーコードをパラメータに追加

   2. ErrorCodes.cs（新規）
      - エラーコード定義クラスを作成
      - 各エラー種別に対応するコード定義

   3. 呼び出し元
      - ErrorDialog.ShowError() の呼び出し箇所を修正
      - エラーコードを指定して呼び出す

   【後方互換性】
   - 既存の ShowError(message) は残す
   - ShowError(errorCode, message) をオーバーロードで追加
   - 既存コードは変更不要
   ```

4. **整理された内容をコピーして、プロンプトの【詳細】に貼り付ける**
   - Claude Web Chatで整理された内容を、そのままコピー
   - このプロンプトテンプレートの【詳細】セクションに貼り付け
   - 必要に応じて微調整

**Web Chatでの対話例：**
```
【あなた】
エラーコードの命名規則はどうすればいいですか？

【Claude】
エラーコードの命名規則の推奨：

1. フォーマット
   - 形式: E + 3桁の数字
   - 例: E001, E002, E999

2. カテゴリ分け
   - E001-E099: ファイル関連エラー
   - E100-E199: 通信エラー
   - E200-E299: データベースエラー
   - E900-E999: その他のエラー

3. 実装例
   ```csharp
   public static class ErrorCodes
   {
       // ファイル関連エラー
       public const string FILE_NOT_FOUND = "E001";
       public const string FILE_ACCESS_DENIED = "E002";

       // 通信エラー
       public const string CONNECTION_TIMEOUT = "E100";
       public const string SERVER_NOT_RESPONDING = "E101";
   }
   ```

この規則により、エラーコードから種別を判別でき、
将来的な拡張も容易になります。
```

### 3. プロンプトの品質向上

**事前整理により得られる効果：**
- ✅ **変更要求が明確になる**：曖昧さがなくなる
- ✅ **影響範囲の見落としが減る**：対話で洗い出せる
- ✅ **spec-analyzerの分析精度が上がる**：明確な要求で正確な分析
- ✅ **spec-doc-generatorの生成品質が上がる**：詳細な情報で高品質な仕様書
- ✅ **手戻りが減る**：実装前に要件が固まる

**整理すべき項目：**
1. 現状と変更後の対比
2. 影響範囲の洗い出し
3. データ構造の変更点（新規クラスなど）
4. UI変更点
5. 設定ファイルの変更点（あれば）
6. 後方互換性の方針
7. 命名規則・フォーマット

### 4. 実践的なワークフロー

```
1. Claude Web Chatで変更要求を整理（15分-30分）
   ↓
2. 整理された内容をプロンプトに反映
   ↓
3. Claude Codeで spec-analyzer を実行
   ↓
4. 分析結果を確認・承認
   ↓
5. spec-doc-generator で仕様書生成
   ↓
6. 実装
```

**時間配分の目安（シンプルな変更）：**
- Web Chatでの整理: 15-30分
- プロンプト作成: 5-10分
- 実際の実行: 15-20分（承認待ち除く）

**合計: 35分-1時間**（整理なしで進めて手戻りするより効率的）

---

## 使用したプロンプト

```markdown
以下の仕様変更を実施してください。

## 変更要求

エラーダイアログのメッセージに、エラーコードを追加表示したい。

【詳細】
- 現在：エラーメッセージのみ表示
- 変更後：エラーコード（例: E001）をメッセージの前に表示
- 表示例：「[E001] ファイルが見つかりません」

## ソースコードの場所

- プロジェクト: D:\MyProject\SRC\
- エラーダイアログ: D:\MyProject\SRC\ErrorDialog.cs
- エラーコード定義: D:\MyProject\SRC\ErrorCodes.cs

## 出力ファイルの保存場所

- 分析結果: D:\MyProject\Output\Analysis\
- 変更仕様書: D:\MyProject\Output\Specs\
- テスト仕様書: D:\MyProject\Output\Tests\

## 実施手順

以下の手順で作業を進めてください。各承認ポイントで必ず私の承認を得てから次に進んでください。

### 1. 事前準備
- TodoListを作成し、全体の作業項目を管理
- 各タスクの完了時にTodoを更新

### 2. 影響範囲分析（spec-analyzer使用）
- spec-analyzerエージェントを起動
- コードベース全体への影響を分析
- 以下のファイルを生成：
  - analysis-result.json
  - analysis-summary.md
- **【承認ポイント1】** 分析結果を提示し、承認を待つ

### 3. 実装計画の作成
- 分析結果に基づいて詳細な実装計画を作成
- 優先順位、リスク、工数見積もりを含める
- **【承認ポイント2】** 実装計画を提示し、承認を待つ

### 4. 変更仕様書とフローチャート生成（spec-doc-generator使用）
- spec-doc-generatorエージェントを起動
- 分析結果（analysis-result.json）を参照
- 以下のファイルを生成：
  - SPEC_CHANGES.html（変更仕様書）
  - flowchart_No001.drawio（フローチャート）
  - TEST_SPECIFICATION.html（テスト仕様書）
- 以下のガイドラインに従うこと：
  - **【重要】想定読者：ソフトウェア開発リーダークラス（設計レビュー担当者）**
  - **【重要】HTMLレイアウト：.claude/agents/spec-doc-generator/SPEC_CHANGES.html を厳守**
  - **設計視点での記述**：ソフトウェアとしての変更方針が見えるレベル
    - 実装詳細の逐次説明は避ける
    - コードの行番号やローカル変数の詳細は記載しない
  - **データ定義は具体的に記載**：クラス構造、プロパティ、INI設定項目
  - 事実ベースで記述し、抽象的・評価的表現を避ける
  - 修正前／修正後の2カラム構成
  - 変更箇所は<span class="highlight">でハイライト
  - 補足事項は各変更点の直後に記載
  - 具体的な設定例、計算式、データ構造を記載
- **【承認ポイント3】** 変更仕様書、フローチャート、テスト仕様書を提示し、承認を待つ

### 5. ソースコード変更の実装
- 承認された仕様書に基づいて実装
- 優先度の高い項目から順に実装
- 後方互換性、エラーハンドリング、リソース管理に注意
- **【承認ポイント4】** 実装完了後、変更内容を提示し、承認を待つ

### 6. 完了報告
- 全ての成果物を確認
- 変更内容のサマリーを報告
- 生成された成果物一覧：
  - analysis-result.json（分析結果）
  - SPEC_CHANGES.html（変更仕様書）
  - flowchart_No001.drawio（フローチャート）
  - TEST_SPECIFICATION.html（テスト仕様書）
  - 変更されたソースコード

## 注意事項

- 各承認ポイントで必ず作業を止め、私の指示を待ってください
- 不明点や懸念事項があれば、すぐに質問してください

それでは、作業を開始してください。
```

## 生成された成果物

- `analysis-result.json` - 影響範囲分析結果
- `analysis-summary.md` - 分析サマリー
- `SPEC_CHANGES.html` - 変更仕様書
- `flowchart_No001.drawio` - フローチャート
- `TEST_SPECIFICATION.html` - テスト仕様書

## 実行結果サマリー

### 影響範囲

**直接影響**:
- ErrorDialog.cs（メッセージ表示ロジックの変更）
- ErrorCodes.cs（エラーコード定義の追加）

**間接影響**:
- Logger.cs（ログ出力形式の更新）

### リスク評価

**全体リスク**: 中リスク

**高リスク領域**:
- ErrorDialog.cs: 既存のエラー表示機能への影響

**中リスク領域**:
- ErrorCodes.cs: エラーコードの一意性の確保

**低リスク領域**:
- Logger.cs: ログ形式の変更のみ

### 工数見積もり

**合計**: small（1-3日）

- 設計: 0.5日
- 実装: 1日
- テスト: 1日
- デプロイ準備: 0.5日

### 実装内容

1. **ErrorCodes.cs**
   - エラーコード定義クラスを追加
   - 各エラーに対するコード（E001, E002...）を定義

2. **ErrorDialog.cs**
   - メッセージ表示ロジックを変更
   - エラーコードを含む形式で表示

3. **Logger.cs**
   - ログ出力形式を更新
   - エラーコードをログに含める

### テストケース

**単体テスト**: 5件
- ErrorCodes定義の確認
- エラーコード表示の確認
- ログ出力形式の確認

**統合テスト**: 3件
- ErrorDialogとErrorCodesの連携
- Loggerとの連携

**実機テスト**: 2件
- 実際のエラー発生時の表示確認
- ログファイルの確認

## 学習ポイント

### 1. プロンプトの書き方

✅ **良い点**:
- 変更要求が明確（現状と変更後を対比）
- ソースの場所が具体的
- 期待する成果物が明示されている

### 2. 承認ポイントの活用

各承認ポイントで確認した内容：
- **承認ポイント1**: 影響範囲が想定通りか
- **承認ポイント2**: 実装計画が現実的か
- **承認ポイント3**: 変更仕様書・フローチャート・テスト仕様書が正確か
- **承認ポイント4**: 実装内容が仕様書通りか

### 3. リスク軽減策

- 既存のエラー処理への影響を最小化
- エラーコードが未定義の場合のフォールバック処理
- 後方互換性の維持（既存コードでも動作）

## 応用例

このサンプルをベースに、以下のような変更にも対応できます：

1. **警告ダイアログへの拡張**
   - エラーダイアログと同じパターンを警告にも適用

2. **多言語対応**
   - エラーコードは固定、メッセージのみ多言語化

3. **ログレベルの追加**
   - エラーコードにログレベル（INFO, WARN, ERROR）を紐付け

## 次のステップ

より複雑な変更については、以下を参照：
- [example-02-complex-change](../example-02-complex-change/) - 複雑な機能追加の例
